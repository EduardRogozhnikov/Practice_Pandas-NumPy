import pandas as pd

# Создаем DataFrame
orders = pd.DataFrame({
    'Клиент': ['Анна', 'Борис', 'Вика', 'Глеб', 'Анна', 'Глеб', 'Дина', 'Борис', 'Анна', 'Дина', 'Глеб'],
    'Товар': ['Книга', 'Ноутбук', 'Книга', 'Книга', 'Телефон', 'Телефон', 'Книга', 'Телефон', 'Книга', 'Ноутбук', 'Книга'],
    'Сумма': [500, 55000, 700, 480, 30000, 31000, 750, 29500, 510, 56000, 470],
    'Город': ['Москва', 'СПб', 'Москва', 'Казань', 'Москва', 'Казань', 'СПб', 'Москва', 'Москва', 'СПб', 'Казань']
})

# Сумму заказов по каждому клиенту и каждому товару (сумма денег).

# Среднюю стоимость заказов по каждому городу и товару.

# Количество заказов по каждому клиенту и городу.

# Максимальную сумму заказа по каждому товару.

# Заполнить пустоты NaN нулями и сохранить таблицу в CSV.

sum_order = orders.pivot_table(index='Клиент', columns='Товар', values='Сумма', aggfunc='sum')
mean_orders = orders.pivot_table(index='Город', columns='Товар', values='Сумма', aggfunc='mean')
count_orders = orders.pivot_table(index="Клиент", columns="Город", values="Сумма", aggfunc="count")
max_sum_orders = orders.groupby('Товар')['Сумма'].max()

sum_order.fillna(0, inplace=True)
sum_order.to_csv("sum_order.csv")
print(sum_order)

orders = pd.DataFrame({
    'Клиент': ['Анна', 'Борис', 'Вика', 'Глеб', 'Анна', 'Глеб', 'Дина', 'Борис', 'Анна', 'Дина', 'Глеб'],
    'Категория': ['Книга', 'Ноутбук', 'Книга', 'Книга', 'Телефон', 'Телефон', 'Книга', 'Телефон', 'Книга', 'Ноутбук', 'Книга'],
    'Сумма': [500, 55000, 700, 480, 30000, 31000, 750, 29500, 510, 56000, 470],
    'Город': ['Москва', 'СПб', 'Москва', 'Казань', 'Москва', 'Казань', 'СПб', 'Москва', 'Москва', 'СПб', 'Казань'],
    'Месяц': ['Январь', 'Январь', 'Февраль', 'Февраль', 'Март', 'Март', 'Март', 'Апрель', 'Апрель', 'Апрель', 'Апрель']
})


orders_1 = pd.DataFrame({
    'Клиент': ['Анна', 'Борис', 'Вика', 'Глеб', 'Анна', 'Глеб', 'Дина', 'Борис', 'Анна', 'Дина', 'Глеб'],
    'Категория': ['Книга', 'Ноутбук', 'Книга', 'Книга', 'Телефон', 'Телефон', 'Книга', 'Телефон', 'Книга', 'Ноутбук', 'Книга'],
    'Сумма': [500, 55000, 700, 480, 30000, 31000, 750, 29500, 510, 56000, 470],
    'Город': ['Москва', 'СПб', 'Москва', 'Казань', 'Москва', 'Казань', 'СПб', 'Москва', 'Москва', 'СПб', 'Казань'],
    'Месяц': ['Январь', 'Январь', 'Февраль', 'Февраль', 'Март', 'Март', 'Март', 'Апрель', 'Апрель', 'Апрель', 'Апрель']
})

"""""""""
Задача 1: Анализ продаж по регионам и товарам
    Описание:
    Тебе дан набор данных о продажах товаров в разных городах за несколько месяцев.
    Нужно:

    Посчитать общее количество продаж по каждому городу.

    Найти среднюю сумму продажи по каждому товару.

    Вывести города, где средняя сумма продажи выше 20 000 руб.

    Определить самый продаваемый товар в каждом городе.

    Сохранить итоговые таблицы в файлы (CSV).

    Данные: (пример)
    orders.csv

    plaintext
    Копировать
    Редактировать
    Город, Товар, Клиент, Сумма
    Москва, Ноутбук, Анна, 55000
    СПб, Книга, Борис, 700
    Москва, Телефон, Вика, 32000
    Казань, Книга, Глеб, 480
    СПб, Телефон, Анна, 31000
    Казань, Ноутбук, Глеб, 60000
    ...
"""""""""""

orders_file = pd.read_CSV("orders.csv")
orders = pd.DataFrame(orders_file)

sum_city = orders.groupby("Город")["Сумма"].sum()

# 1. Загружаем или создаём данные
orders = pd.DataFrame({
    'Клиент': ['Анна', 'Борис', 'Вика', 'Глеб', 'Анна', 'Глеб'],
    'Товар': ['Книга', 'Ноутбук', 'Книга', 'Книга', 'Телефон', 'Телефон'],
    'Сумма': [500, 55000, 700, 480, 30000, 31000],
    'Город': ['Москва', 'СПб', 'Москва', 'Казань', 'Москва', 'Казань']
})


summary = orders.groupby('Город').agg({
    'Сумма': ['sum', 'mean', 'count']
})

total_sales = orders['Сумма'].sum()
summary["Доля продаж (%)"] = (summary[('Сумма', 'sum')] / total_sales) * 100
summary["Доля продаж (%)"] = summary["Доля продаж (%)"].round(2)
print(summary)

# Чтение файла
#orders = pd.read_csv("orders.csv")
orders = pd.DataFrame({
    'Клиент': ['Анна', 'Борис', 'Вика', 'Глеб', 'Анна', 'Глеб'],
    'Товар': ['Книга', 'Ноутбук', 'Книга', 'Книга', 'Телефон', 'Телефон'],
    'Сумма': [500, 55000, 700, 480, 30000, 31000],
    'Город': ['Москва', 'СПб', 'Москва', 'Казань', 'Москва', 'Казань']
})

# Группировка с расчётом суммы, среднего и количества заказов
summary = orders.groupby('Город').agg(
    Сумма_Продаж=('Сумма', 'sum'),
    Средний_Чек=('Сумма', 'mean'),
    Количество_Заказов=('Сумма', 'count')
).reset_index()

# Расчёт общего объема продаж
total_sales = summary['Сумма_Продаж'].sum()

# Расчёт доли продаж для каждого города
summary['Доля_Продаж_Проценты'] = (summary['Сумма_Продаж'] / total_sales * 100).round(2)

# Вывод итоговой таблицы
summary = summary.sort_values(by='Сумма_Продаж', ascending=False)
print(summary)


